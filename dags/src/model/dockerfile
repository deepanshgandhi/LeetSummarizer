# Use the NVIDIA CUDA image as the base image
FROM nvidia/cuda:11.8.0-devel-ubuntu20.04

# Set the working directory
WORKDIR /root

# Install dependencies
RUN apt-get update && apt-get install -y \
    software-properties-common \
    wget \
    && rm -rf /var/lib/apt/lists/*

# Add deadsnakes PPA for Python 3.8.10
RUN add-apt-repository ppa:deadsnakes/ppa

# Install Python 3.8.10
RUN apt-get update && apt-get install -y \
    python3.8 \
    python3.8-dev \
    python3.8-distutils \
    && rm -rf /var/lib/apt/lists/*

# Install pip for Python 3.8
RUN wget https://bootstrap.pypa.io/get-pip.py && \
    python3.8 get-pip.py && \
    rm get-pip.py

# Install Git
RUN apt-get update && apt-get install -y git && rm -rf /var/lib/apt/lists/*

# Ensure pip is up to date
RUN python3.8 -m pip install --upgrade pip

# Copy training script
COPY train.py /root/train.py

# Set the command to run the training script
CMD ["python3.8", "train.py"]